import { Editor } from 'tinymce/core/api/Editor';
import { Toolbar } from '@ephox/bridge';

const stateSelectorAdapter = (editor: Editor, selector: string[]) => (buttonApi: Toolbar.ToolbarToggleButtonInstanceApi) =>
  editor.selection.selectorChangedWithUnbind(selector.join(','), buttonApi.setActive).unbind;

const register = function (editor: Editor) {
  editor.ui.registry.addButton('nycmap', {
    tooltip: 'Insert/edit NYC Map',
    text: '<svg width="25" height="25"><g transform="matrix(0.5,0,0,0.5,0,0.024414)"><path d="M 35,2 C 30.601563,2 27,5.800781 27,10.402344 27,15 35,26 35,26 35,26 43,15 43,10.402344 43,5.800781 39.398438,2 35,2 Z M 24,6.101563 C 21.199219,6.800781 18.800781,10.601563 17.402344,16 L 24,16 Z M 19.800781,6.699219 C 14.5,8.097656 10,11.398438 7.101563,16 l 8.199218,0 c 1,-4 2.601563,-7.199219 4.5,-9.300781 z M 35,7 c 1.699219,0 3,1.300781 3,3 0,1.699219 -1.300781,3 -3,3 -1.699219,0 -3,-1.300781 -3,-3 0,-1.699219 1.300781,-3 3,-3 z M 6.101563,18 c -1.203125,2.398438 -1.902344,5.101563 -2,8 l 9.996093,0 c 0,-2.800781 0.304688,-5.5 0.703125,-8 z m 10.800781,0 c -0.5,2.5 -0.800781,5.199219 -0.902344,8 l 8,0 0,-8 z M 26,18 l 0,8 6.5,0 c -1.199219,-1.800781 -3.300781,-4.800781 -5,-8 z m 16.402344,0 c -1.703125,3.199219 -3.703125,6.199219 -5,8 l 8.5,0 c -0.101563,-2.898437 -0.800781,-5.601562 -2,-8 z M 4,28 c 0.101563,2.898438 0.800781,5.601563 2,8 l 8.800781,0 C 14.402344,33.5 14.101563,30.800781 14,28 Z m 12,0 c 0.101563,2.800781 0.402344,5.5 0.902344,8 L 24,36 24,28 Z m 10,0 0,8 7.097656,0 c 0.5,-2.5 0.800782,-5.199219 0.902344,-8 z m 10,0 c -0.101562,2.800781 -0.300781,5.5 -0.800781,8 L 44,36 c 1.199219,-2.398437 1.898438,-5.101562 2,-8 z M 7.101563,38 c 2.796875,4.601563 7.296875,7.902344 12.597656,9.300781 C 17.800781,45.199219 16.199219,42 15.199219,38 Z m 10.300781,0 C 18.800781,43.300781 21.199219,47.101563 24,47.902344 L 24,38 Z M 26,38 26,47.902344 C 28.800781,47.199219 31.199219,43.398438 32.597656,38 Z m 8.597656,0 c -0.898437,4 -2.5,7.199219 -4.398437,9.300781 C 35.5,45.902344 40,42.5 42.800781,38 Z"/></g></svg>',
    onAction: () => {
      editor.execCommand('mceNycmap');
    },
    onSetup: stateSelectorAdapter(editor, ['img[data-mce-object]', 'span[data-mce-object]', 'div[data-ephox-embed-iri]'])
  });
};

export default {
  register
};